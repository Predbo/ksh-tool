<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>KSH Ausdrucken</title>

    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/ksh.css">
    
    <script src="js/jquery-1.12.0.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/sockjs-0.3.4.min.js"></script>
	<script src="js/vertx-eventbus.js"></script>
	<script src="js/ksh.js"></script>
</head>
<body>
	<div id="content"/>
	<script>
	
		$(function() {
			$.get("/kshentries", function(data) {
				sortFamilyPrice(data);
				drawTable(data);
			});
		});
		
		function drawTable(data) {
			var oldFamilyNumber = data[0].familyNumber;
			var priceSum = 0;
			drawNewFamilyHead(data[0].familyNumber);
		    for (var i = 0; i < data.length; i++) {
		    	if (data[i].familyNumber != oldFamilyNumber) {
		    		drawOldFamilyTail(oldFamilyNumber, priceSum);
		    		priceSum = 0;
		    		drawNewFamilyHead(data[i].familyNumber);
		    		oldFamilyNumber = data[i].familyNumber;
		    	}
		        drawRow(data[i]);
		        priceSum+=data[i].price;
		    }
		    drawOldFamilyTail(oldFamilyNumber, priceSum);
		}
	
		function drawNewFamilyHead(familyNumber) {
		    var htmlContent = "<h1 style=\"page-break-before:always\">Kinder-Second-Hand Basar</h1>" + 
		    	"<h2>der Kolpingsfamilie Köln-Brück</h2>"+ 
		    	"<h3>Familiennummer: " + familyNumber + "</h3>" + 
		    	"<table class=\"table table-striped table-bordered\">" + 
		    	"<thead>" + 
		    	"<th class=\"small\">Nummer</th>" + 
		    	"<th class=\"small\">Preis</th>" + 
				"</tr>" + 
		    	"</thead>" + 
		    	"<tbody id=\"tableContent-" + familyNumber + "\">" + 
		    	"</table>"		    	
		    $("#content").append(htmlContent);
		}
		
		function drawRow(rowData) {
		    var row = $("<tr>")
		    $("#tableContent-" + rowData.familyNumber).append(row);
		    row.append($("<td>" + rowData.sheetNumber + "-" + rowData.currentNumber + "</td><td>" + rowData.price + "</td></tr>"));
		}
		
		function drawOldFamilyTail(familyNumber, priceSum) {
		    var row = $("<tr/>")
		    $("#tableContent-" + familyNumber).append(row);
		    row.append($("<td>Summe:</td><td>" + priceSum + "</td>"));
		}
		
	</script>
</body>
</html>
