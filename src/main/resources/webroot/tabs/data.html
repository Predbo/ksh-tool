		<table class="table table-striped table-bordered">
	        <thead>
	           <tr>
	               <th class="small">Blatt Nummer</th>
	               <th class="unimportant">Laufende Nummer</th>
	               <th class="small">Familien Nummer</th>
	               <th class="small">Preis</th>
	               <th class="small center">Löschen</th>
	           </tr>
	       </thead>
			<tbody>
				<tr id="inputRow">
					<td>
						<input type="text" class="form-control" id="sNumber">
					</td>
					<td class="unimportant">
						<input type="text" class="form-control" id="cNumber">
					</td>	
					<td>
						<input type="text" class="form-control" id="fNumber">
					</td>
					<td>
						<input type="text" class="form-control" id="price">
					</td>
					<td class="center">
						<p style="font-size:13px;">fehlerhafte Eingaben müssen gelöscht und neu eingegeben werden</p>
					</td>
				</tr>
	       </tbody>
		</table>


<script>

	var eb = new EventBus('http://localhost:8080/eventbus');

	eb.onopen = function() {
		// Nothing to do
	}
	
	$(function() {
		$.get("/kshentries", function(data) {
			sortSheetCurrent(data);
			$("#sNumber").val(data[data.length-1].sheetNumber);
			$("#cNumber").val(data[data.length-1].currentNumber+1);
			drawTable(data);
			registerClickHandlers();
			$("#fNumber").focus();
		});
	});
	

	
	function drawTable(data) {
	    for (var i = 0; i < data.length; i++) {
	        drawRow(data[i]);
	    }
	}
	function drawRow(rowData) {
	    $("<tr id=\"" + rowData.sheetNumber + "-" + rowData.currentNumber + "\">" + 
	        "<td>" + rowData.sheetNumber + "</td>" + 
	        "<td class=\"unimportant\">" + rowData.currentNumber + "</td>" + 
	        "<td>" + rowData.familyNumber + "</td>" + 
	        "<td>" + getEuroPrice(rowData.price) + "</td>" +
	        "<td class=\"center\"><a data-target=\"" + rowData.sheetNumber + "-" + rowData.currentNumber + "\" type=\"button\" class=\"btn btn-danger deleteEntry\"><span class=\"glyphicon glyphicon-trash\"></span> Eintrag Löschen</a></td>" + 
	      "</tr>").insertAfter("#inputRow")
	}
	
	function registerClickHandlers() {
		$('.deleteEntry').click(function() {
			var data = $(this).attr('data-target');
			eb.send('web.client2server.remove.entry', data, function(err, reply) {
				if (reply.body.toString().contains("ERROR")) {
					alert(reply.body);
				} else {
					$("#"+data).hide(1000);
				}
			});
		});
	}
	
	
	var submitEntry = function () {
		var data = new Object;
		data.sheetNumber = $("#sNumber").val();
		data.currentNumber = $("#cNumber").val();
		data.familyNumber = $("#fNumber").val();
		data.price = $("#price").val().replace(",", ".");
		eb.send('web.client2server.add.entry', data, function(err, reply) {
			if (reply.body.toString().contains("ERROR")) {
				alert(reply.body);
			} else {
				drawRow(reply.body);
			}
		});
		$("#fNumber").focus();
		
		if ($('#cNumber').val() == 60) {
			alert("Blatt " + $('#sNumber').val() + " fertig!");
			$('#cNumber').val(1);
			$('#sNumber').val( function(i, oldval) {
		    	return ++oldval;
			});
		} else {
			$('#cNumber').val( function(i, oldval) {
		    	return ++oldval;
			});
		}
		$("#fNumber").val("");
		$("#price").val("");
	}
	
	$('#sNumber').keypress(function (e) {
	  	if (e.which == 13) {
	  		$("#cNumber").focus();
	  		return false;
	  	}
	});
	
	$('#cNumber').keypress(function (e) {
	  	if (e.which == 13) {
	  		$("#fNumber").focus();
	  		return false;
	  	}
	});
	
	$('#fNumber').keypress(function (e) {
	  	if (e.which == 13) {
	  		$("#price").focus();
	  		return false;
	  	}
	});
	
	$('#price').keypress(function (e) {
		var code = e.keyCode || e.which;
	    if (code === 9 || e.which == 13) {
	    	submitEntry();
	    	return false;
	  	}
	});
	
	$('#sNumber').change(function() {
		$('#cNumber').val(1);
	});
	
	$('.deleteEntry').click(function() {
		alert( "Handler for .click() called." );
        /* var data = $(this).attr('data-target');
		eb.send('web.client2server.remove.entry', data, function(err, reply) {
			$("#"+data).css("display", "none");
		}); */
	});
	
</script>
